<!DOCTYPE html>
<html>
	<head>
    	<meta charset="utf-8">
		<title>Gositi - Discord-fs</title>
		<link rel="stylesheet" href="/style.css" />
		<link rel="icon" type="image/jpg" href="/favicon.ico">
	</head>
	<body>
		<div>
			<a href="/"> home /</a>
			<a href="/projekt"> projekt /</a>
			<a href="/projekt/discord-fs"> discord-fs /</a>
		</div>
		<hr>
		<div>
			<h1>Discord-fs</h1>
			<p>
				Ett försök till att göra ett filsystem, i Discord.
				Mer exakt, använda filer uppladdade till Discord som "molnlagring", med åtkomst via ett lokalt virtuellt filsystem (genom FUSE).
			</p>
			<p>
				Projektet är fungerande, men saknar för nuvarande viss funktionalitet som jag gärna tar med i framtiden.
				Det fungerar dock utmärkt för att skriva och läsa filer under 250MiB (Discords gräns på 25MiB per fil gånger 10 filer per meddelande), även om det såklart är rätt långsamt.
				All kod och mer information finns på Github, <a href="https://github.com/Gositi/discord-fs">här</a>, om du är intresserad av att undersöka det närmare.
			</p>
		</div>
		<div>
			<h2>FUSE</h2>
			<p>
				Jag har nämnt att jag använder något som heter FUSE i mitt filsystem.
				FUSE är en bit mjukvara som gör att man kan "skapa sitt eget" filsystem.
				Man behöver bara implementera vissa metoder och FUSE sköter resten, för resten av systemet ser det ut som ett helt vanligt filsystem bara.
				Detta är såklart väldigt användbart för mitt projekt, så jag bestämde mig för att använda FUSE.
			</p>
			<p>
				På <a href="https://thepythoncorner.com/posts/2017-02-27-writing-a-fuse-filesystem-in-python/">denna länk</a> finns en grundläggande genomgång av hur FUSE fungerar med Python.
				Jag lyckades skapa en minimal version av "passthrough"-filsystemet genom att testa vad jag kunde ta bort utan att ha sönder allt för mycket.
				Detta var ett bra sätt att bekanta mig lite mer med filsystem och FUSE-biblioteket jag använde.
			</p>
			<p>
				Nästa steg blev då givetvis att skapa något mera eget med bas i detta.
				Tanken var att förlänga "passthrough"-systemet genom att bara faktiskt ge åtkomst till en tillfällig fil som är en kopia av den riktiga filen.
				Detta skulle underlätta ihopkopplingen med Discord senare, för då vore FUSE-delen av projektet nästan klar.
				Att utföra detta innebar visst krångel, men till sist fungerade det i princip felfritt och jag kunde t.ex. redigera en fil i mitt passthrough-filsystem.
			</p>
			<p>
				Detta steg hade också skapats genom att låta en separat klass sköta all interaktion med där filerna faktiskt bor.
				På så vis kunde den klassen senare bytas ut mot en koppling till Discord, utan att ens behöva modifiera FUSE-klassen.
			</p>
		</div>
		<div>
			<h2>Discord</h2>
			<p>
				Efter detta behövdes också en koppling till Discord med stöd för grundläggande upp- och nerladdning av filer.
				Python-biblioteket discord.py användes för detta, genom en discordbot.
				Ett problem som detta innebar är dock att både köra botten och filsystemet samtidigt, eftersom funktionsanropet för att köra botten blockerar övrig kodexekvering.
				Detta löstes dock enkelt genom att låta botten köra i en separat tråd och kommunicera med övriga komponenter genom en form av kö.
			</p>
			<p>
				Att därefter skriva komponenter till min Discord-klass som skötte upp- och nedladdning av filer för olika situationer var ganska enkelt.
				Detta fungerade i princip felfritt, med bara några mindre fel jag behövde rätta till.
				Information om vilka filer som finns och i vilket meddelande sparas lokalt, i en så kallad File Allocation Table (FAT), dock skulle jag gärna vilja ha denna på Discord någon gång i framtiden också.
				Här var i vilket fall den första versionen av projektet i princip klart!
			</p>
		</div>
		<div>
			<h2>Vidareutveckling</h2>
			<p>
				Här fungerade i princip programmet, men det fanns fortfarande mycket att göra.
				Dels upptäcktes buggar och andra problem efter hand, som behövde åtgärdas.
				Dessutom ville jag lägga på mer funktionalitet, t.ex. stöd för större filer.
				Detta gjordes genom att dela upp för stora filer i mindre beståndsdelar och ladda upp delarna som bilagor till samma meddelande.
				På så vis behövdes inte ens en ändring i FAT:en.
			</p>
		</div>
		<div>
			<h2>Framtiden</h2>
			<p>
				Jag har självklart också planer på att lägga till än mer funktionalitet, eftersom en hel del fortfarande saknas.
				En kortare lista med saker jag planerar eller skulle vilja ha är:
				<ul>
					<li>Filer större än 25MiB (d.v.s. uppdelat på flera meddelanden)</li>
					<li>Mer metadata om filer som datum, behörigheter, filmode, etc.</li>
					<li>Stöd för mappar i filsystemet</li>
					<li>FAT lagrad på Discord</li>
				</ul>
				Alla dessa komponenter skulle i huvudsak egentligen endast kräva en mer avancerad FAT, och inte så mycket annat.
				Allt det grundläggande för att detta ska kunna bli verklighet är ju redan implementerat!
				Därför är det jag huvudsakligen arbetar med för framtiden just att tänka ut ett bra sätt att bygga en mer avancerad FAT på.
			</p>
		</div>
	</body>
</html>
